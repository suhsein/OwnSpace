<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{/fragment/head :: common_head(~{::title}, ~{::link})}">
    <title>일상</title>
    <link rel="stylesheet" href="">
</head>
<body>
<div th:replace="~{/fragment/navigation :: navigation ('daily')}"></div>
<div class="container mb-5" style="max-width: 80%">
    <h5 class="mt-3 fw-bold me-5 mb-3">게시물 상세 보기</h5>
    <hr>
    <h4 class="fw-bold me-5" th:text="${daily.title}"></h4>
    <div style="font-size:0.8rem">
        <span th:text="'작성자 ' + ${daily.writer == null ? '익명' : daily.writer.username}"></span>
        <span th:text="'  |  게시일 ' + ${#temporals.format(daily.createDate, 'yyyy.MM.dd HH:mm:ss')}"></span>
        <span th:text="'  |  조회수 ' + ${daily.views}"></span>
        <p th:if="${daily.updateDate != null}"
           th:text="'수정일 ' + ${#temporals.format(daily.updateDate, 'yyyy.MM.dd HH:mm:ss')}"></p>
    </div>
    <hr>
    <div th:utext="${daily.content}" class="mb-3"></div>
    <div class="d-flex justify-content-end">
        <button class="btn btn-primary me-2" th:onclick="|location.href='@{/daily/edit/{id}(id=${id})}'|">수정하기</button>
        <button class="btn btn-secondary" th:onclick="|location.href='@{/daily/delete/{id}(id=${id})}'|">삭제하기</button>
    </div>
    <hr>
    <div class="card text-bg-light mb-3">
        <div class="card-body">
            <h5 class="card-title" th:text="|댓글  ${daily.commentList.size()}개|">댓글</h5>
        </div>
    </div>
    <div th:replace="~{/fragment/comment-list :: comment-list}"></div>
    <div class="card" id="comment_box">
        <div class="card-header">댓글 입력</div>
        <div class="card-body">
            <form th:action="@{/daily/addComment/{id}(id=${id})}" th:object="${commentForm}" method="post">
                <textarea th:field="*{content}" cols="30" rows="5" class="form-control"></textarea>
                <button class="btn btn-primary mt-2" type="submit">submit</button>
            </form>
        </div>
    </div>
</div>
<footer th:replace="~{/fragment/footer :: footer}"></footer>
<script src="./js/bootstrap.bundle.js" th:src="@{/js/bootstrap.bundle.js}"></script>
</body>
</html>
<script>
    const $reply_btn_list = document.querySelectorAll('.reply_btn');
    const $comment_box = document.getElementById('comment_box');

    for (const $reply_btn of $reply_btn_list) {
        $reply_btn.addEventListener('click', () => {
            let reply_btn_id = $reply_btn.getAttribute('id');
            let idx = reply_btn_id.substring(reply_btn_id.lastIndexOf('_') + 1);
            console.log(idx);
            let $reply_box = document.getElementById('reply_box_' + idx);
            console.log($reply_box);
            if ($reply_btn.textContent === '↪reply') {
                $reply_btn.textContent = '취소';
                $comment_box.style.display = 'none';
                $reply_box.style.display = 'block';
            } else {
                $reply_btn.textContent = '↪reply';
                $comment_box.style.display = 'block';
                $reply_box.style.display = 'none';
            }
        });
    }

</script>

