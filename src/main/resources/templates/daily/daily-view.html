<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{/fragment/head :: common_head(~{::title}, ~{::link})}">
    <title>일상</title>
    <link rel="stylesheet" href="">
</head>
<body>
<div th:replace="~{/fragment/navigation :: navigation ('daily')}"></div>
<div class="container mb-5" style="max-width: 80%">
    <div th:replace="~{/fragment/daily-content :: daily-content}"></div>
    <div th:replace="~{/fragment/comment-list :: comment-list}"></div>
    <div class="card" id="comment_box">
        <div class="card-header">댓글 입력</div>
        <div class="card-body">
            <form th:action="@{/daily/addComment/{id}(id=${id})}" th:object="${commentForm}" method="post">
                <textarea th:field="*{content}" cols="30" rows="5" class="form-control"></textarea>
                <button class="btn btn-primary mt-2" type="submit">확인</button>
            </form>
        </div>
    </div>
    <ul class="list-group mt-3">
        <a th:if="${nxtDaily != null}" th:href="@{/daily/dailyView/{id}(id=${nxtDaily.id})}"
           class="list-group-item list-group-item-action">
            <span class="me-3">&#9652; 다음글</span>
            <span th:text="|${nxtDaily.title}|"></span>
        </a>
        <a th:if="${prevDaily != null}" th:href="@{/daily/dailyView/{id}(id=${prevDaily.id})}"
           class="list-group-item list-group-item-action">
            <span class="me-3">&#9662; 이전글</span>
            <span th:text="|${prevDaily.title}|"></span>
        </a>
    </ul>
    <div class="d-flex mt-2 justify-content-end">
        <a class="btn btn-primary" th:href="@{/daily}">목록으로</a>
    </div>
</div>
<footer th:replace="~{/fragment/footer :: footer}"></footer>
<script src="./js/bootstrap.bundle.js" th:src="@{/js/bootstrap.bundle.js}"></script>
</body>
</html>
<script th:inline="javascript">
    const $reply_btn_list = document.querySelectorAll('.reply_btn');
    const $comment_box = document.getElementById('comment_box');

    for (const $reply_btn of $reply_btn_list) {
        $reply_btn.addEventListener('click', () => {
            let reply_btn_id = $reply_btn.getAttribute('id');
            let idx = reply_btn_id.substring(reply_btn_id.lastIndexOf('_') + 1);
            let $reply_box = document.getElementById('reply_box_' + idx);
            if ($reply_btn.textContent === '↪답글') {
                $reply_btn.textContent = '취소';
                $comment_box.style.display = 'none';
                $reply_box.style.display = 'block';
            } else {
                $reply_btn.textContent = '↪답글';
                $comment_box.style.display = 'block';
                $reply_box.style.display = 'none';
            }
        });
    }

    const onSearch = [[${onSearch}]];
    const code = [[${code}]];
    const keyword = [[${keyword}]];

    function highlight(keyword){
        if(code === 'TITLE_CONTENT' || code === 'CONTENT'){
            const $nodeListOfTitle = document.querySelectorAll('.content');
            makeHighlight(keyword, $nodeListOfTitle);
        } else if(code === 'WRITER'){
            const $nodeListOfWriter = document.querySelectorAll('.writer');
            makeHighlight(keyword, $nodeListOfWriter);
        }
    }
    function makeHighlight(keyword, $nodeList){
        for (const $node of $nodeList) {
            let innerHTML = $node.innerHTML;
            if(innerHTML.includes(keyword)){
                let idx = innerHTML.indexOf(keyword);
                innerHTML = innerHTML.substring(0, idx) + "<span class='highlight'>"
                    + innerHTML.substring(idx, idx + keyword.length) + "</span>" + innerHTML.substring(idx + keyword.length);
                $node.innerHTML = innerHTML;
            }
        }
    }

    if(onSearch === true){
        console.log(keyword);
        window.onload = highlight(keyword);
    }
</script>

